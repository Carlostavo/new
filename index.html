<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestión de Residuos Sólidos</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { margin:0; font-family: 'Segoe UI', sans-serif; background:#f8f9fa; color:#2c3e50; }
    .navbar { background:#2c3e50; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    .navbar .logo { color:white; font-size:1.5rem; font-weight:600; }
    .nav-links { list-style:none; display:flex; }
    .nav-links li { margin-left:20px; }
    .nav-links a { color:white; text-decoration:none; padding:6px 10px; border-radius:4px; }
    .nav-links a:hover { background:rgba(255,255,255,0.1); color:#3498db; }
    .auth-buttons { display:flex; align-items:center; }
    .login-btn,.edit-btn,.logout-btn { border:none; border-radius:4px; padding:8px 14px; cursor:pointer; margin-left:8px; font-weight:500; }
    .login-btn { background:#3498db; color:white; }
    .login-btn:hover { background:#2980b9; }
    .edit-btn { background:#27ae60; color:white; display:none; }
    .logout-btn { background:#e74c3c; color:white; display:none; }
    .container { max-width:1000px; margin:30px auto; background:white; padding:30px; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.1); }
    header { text-align:center; margin-bottom:30px; }
    header h1 { font-size:2rem; margin-bottom:8px; }
    /* Modal */
    .modal { 
      display:none; 
      position:fixed; 
      top:0; left:0; 
      width:100%; height:100%; 
      background:rgba(0,0,0,0.5); 
      justify-content:center; 
      align-items:center; 
      z-index:1000; 
    }
    .modal-content { 
      position:relative;
      background:white; 
      padding:25px; 
      border-radius:6px; 
      width:90%; 
      max-width:380px; 
      box-shadow:0 0 15px rgba(0,0,0,0.3); 
    }
    .close-btn {
      position:absolute;
      top:10px;
      right:15px;
      font-size:1.2rem;
      font-weight:bold;
      color:#888;
      cursor:pointer;
    }
    .close-btn:hover { color:#000; }
    .form-group { margin-bottom:18px; }
    .form-group input { width:100%; padding:10px; border:1px solid #ddd; border-radius:4px; }
    .modal-login-btn { width:100%; padding:12px; background:#3498db; border:none; color:white; border-radius:4px; font-weight:500; cursor:pointer; }
    .error-message,.success-message { display:none; padding:10px; margin-top:10px; border-radius:4px; font-size:0.9rem; }
    .error-message { background:#fadbd8; color:#c0392b; }
    .success-message { background:#d5f5e3; color:#27ae60; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo">Sistema de Residuos</div>
    <ul class="nav-links">
      <li><a href="#">Inicio</a></li>
      <li><a href="#">Indicadores</a></li>
      <li><a href="#">Metas</a></li>
      <li><a href="#">Avances</a></li>
      <li><a href="#">Reportes</a></li>
      <li><a href="#">Formularios</a></li>
    </ul>
    <div class="auth-buttons">
      <button class="login-btn" id="navbarLoginBtn">Iniciar Sesión</button>
      <div id="userMenu" style="display:none; color:white;">
        <span id="userName"></span>
        <button class="edit-btn" id="editBtn">Modo Edición</button>
        <button class="logout-btn" id="logoutBtn">Cerrar Sesión</button>
      </div>
    </div>
  </nav>

  <!-- Contenido -->
  <div class="container">
    <header>
      <h1>Sistema de Gestión de Residuos Sólidos</h1>
      <p>Monitorea indicadores, gestiona metas y genera reportes de sostenibilidad.</p>
    </header>
  </div>

  <!-- Modal login -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <span class="close-btn" id="closeModal">&times;</span>
      <h2>Iniciar Sesión</h2>
      <form id="loginForm">
        <div class="form-group">
          <input type="email" id="email" placeholder="Correo" required>
        </div>
        <div class="form-group">
          <input type="password" id="password" placeholder="Contraseña" required>
        </div>
        <button type="submit" class="modal-login-btn">Entrar</button>
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
      </form>
    </div>
  </div>

  <script>
    // Configuración de Supabase
    const supabaseUrl = "<TU_SUPABASE_URL>";
    const supabaseAnonKey = "<TU_SUPABASE_ANON_KEY>";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

    const loginModal = document.getElementById('loginModal');
    const loginForm = document.getElementById('loginForm');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const navbarLoginBtn = document.getElementById('navbarLoginBtn');
    const userMenu = document.getElementById('userMenu');
    const userName = document.getElementById('userName');
    const editBtn = document.getElementById('editBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const closeModal = document.getElementById('closeModal');

    // Abrir modal al dar clic en "Iniciar Sesión"
    navbarLoginBtn.onclick = () => {
      loginModal.style.display = 'flex';
    };

    // Cerrar modal al hacer clic fuera
    window.onclick = e => {
      if (e.target === loginModal) loginModal.style.display = 'none';
    };

    // Botón cerrar (X)
    closeModal.onclick = () => {
      loginModal.style.display = 'none';
    };

    // Manejar login
    loginForm.onsubmit = async e => {
      e.preventDefault();
      errorMessage.style.display = 'none'; successMessage.style.display = 'none';

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const { data, error } = await supabase.auth.signInWithPassword({ email, password });

      if (error) {
        errorMessage.textContent = error.message;
        errorMessage.style.display = 'block';
      } else {
        successMessage.textContent = "Inicio de sesión exitoso";
        successMessage.style.display = 'block';
        userMenu.style.display = 'flex';
        userName.textContent = data.user.email;
        navbarLoginBtn.style.display = 'none';
        editBtn.style.display = 'inline-block'; // 🔥 se activa modo edición
        logoutBtn.style.display = 'inline-block';
        setTimeout(() => loginModal.style.display = 'none', 1200);
      }
    };

    // Cerrar sesión
    logoutBtn.onclick = async () => {
      await supabase.auth.signOut();
      userMenu.style.display = 'none';
      navbarLoginBtn.style.display = 'block';
      editBtn.style.display = 'none';
      logoutBtn.style.display = 'none';
    };

    // Mantener sesión si ya está iniciada
    (async () => {
      const { data } = await supabase.auth.getSession();
      if (data.session?.user) {
        userMenu.style.display = 'flex';
        userName.textContent = data.session.user.email;
        navbarLoginBtn.style.display = 'none';
        editBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'inline-block';
      }
    })();
  </script>
</body>
</html>
